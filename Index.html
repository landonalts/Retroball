<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixel Baseball - Advanced Pitching</title>
  <style>
    body {
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: monospace;
      user-select: none;
    }

    canvas {
      width: 600px;
      height: 400px;
      background: #87CEEB;
      border: 3px solid #333;
      image-rendering: pixelated;
      touch-action: manipulation;
    }

    #controls {
      margin: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      font-size: 16px;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: #333;
      color: white;
      cursor: pointer;
    }

    #info {
      color: white;
      font-size: 16px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="pitchBall('fastball')">Fastball</button>
    <button onclick="pitchBall('curveball')">Curveball</button>
    <button onclick="pitchBall('changeup')">Changeup</button>
    <button onclick="swingBat()">Swing</button>
  </div>
  <canvas id="gameCanvas" width="300" height="200"></canvas>
  <div id="info">Balls: 0 | Strikes: 0 | Outs: 0</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const strikeZone = { x: 130, y: 150, width: 40, height: 30 };

    const ball = {
      x: 150,
      y: 60,
      z: 20,
      speed: 0.6,
      vx: 0,
      active: false,
      hit: false,
      pitchType: "fastball"
    };

    const batter = { swinging: false, frame: 0 };
    const pitcher = { pitching: false, frame: 0 };

    let balls = 0;
    let strikes = 0;
    let outs = 0;

    function updateInfo() {
      document.getElementById("info").textContent =
        `Balls: ${balls} | Strikes: ${strikes} | Outs: ${outs}`;
    }

    function drawField() {
      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, 140, canvas.width, 60);
      ctx.fillStyle = "#FFD700";
      ctx.fillRect(145, 170, 10, 5); // home plate

      // Draw strike zone
      ctx.strokeStyle = "white";
      ctx.lineWidth = 1;
      ctx.strokeRect(strikeZone.x, strikeZone.y, strikeZone.width, strikeZone.height);
    }

    function drawBall() {
      if (!ball.active) return;
      const scale = 1 + (20 - ball.z) * 0.2;
      const radius = 2 * scale;
      const screenY = 100 + ball.z;

      ctx.beginPath();
      ctx.arc(ball.x, screenY, radius, 0, Math.PI * 2);
      ctx.fillStyle = "white";
      ctx.fill();
      ctx.strokeStyle = "#ccc";
      ctx.stroke();
    }

    function drawBatter() {
      ctx.fillStyle = "#444";
      ctx.fillRect(230, 160, 8, -20);
      ctx.fillStyle = "#FFD700";

      if (batter.swinging && batter.frame < 5) {
        ctx.fillRect(215, 140, 20 - batter.frame, 3);
        batter.frame++;
      } else {
        ctx.fillRect(235, 140, 5, 20);
      }
    }

    function drawPitcher() {
      ctx.fillStyle = "#888";
      ctx.fillRect(70, 60, 8, 20);
      ctx.fillStyle = "#87CEEB";

      if (pitcher.pitching && pitcher.frame < 5) {
        ctx.fillRect(60 + pitcher.frame, 60, 8, 8);
        pitcher.frame++;
      } else {
        ctx.fillRect(65, 60, 8, 8);
      }
    }

    function updateBall() {
      if (!ball.active) return;

      ball.z -= ball.speed;
      ball.x += ball.vx;

      if (ball.z <= 0 && !ball.hit) {
        ball.active = false;
        evaluatePitch();
      }
      if (ball.hit) {
        ball.z += 1.5;
      }
    }

    function evaluatePitch() {
      const isInZone = (
        ball.x >= strikeZone.x &&
        ball.x <= strikeZone.x + strikeZone.width &&
        100 >= strikeZone.y &&
        100 <= strikeZone.y + strikeZone.height
      );

      if (batter.swinging) {
        if (isInZone) {
          // hit
        } else {
          strikes++;
        }
      } else {
        if (isInZone) {
          strikes++;
        } else {
          balls++;
        }
      }

      if (strikes >= 3) {
        strikes = 0;
        balls = 0;
        outs++;
      }

      if (balls >= 4) {
        balls = 0;
        strikes = 0;
        // Walk - ignore base logic for now
      }

      if (outs >= 3) {
        balls = 0;
        strikes = 0;
        outs = 0;
        alert("3 Outs! Inning over.");
      }

      updateInfo();
    }

    function swingBat() {
      if (!ball.active) return;
      batter.swinging = true;
      batter.frame = 0;

      const isInZone = (
        ball.x >= strikeZone.x &&
        ball.x <= strikeZone.x + strikeZone.width &&
        100 >= strikeZone.y &&
        100 <= strikeZone.y + strikeZone.height
      );

      if (ball.z <= 3 && ball.z >= 0 && isInZone) {
        ball.hit = true;
        ball.speed = 0;
      }
    }

    function pitchBall(type = "fastball") {
      if (ball.active) return;

      ball.pitchType = type;
      ball.x = 150;
      ball.z = 20;
      ball.hit = false;
      batter.swinging = false;

      // Define pitch properties
      switch (type) {
        case "fastball":
          ball.speed = 0.7 + Math.random() * 0.1;
          ball.vx = (Math.random() - 0.5) * 0.5;
          break;
        case "curveball":
          ball.speed = 0.5;
          ball.vx = 0.5;
          break;
        case "changeup":
          ball.speed = 0.3;
          ball.vx = (Math.random() - 0.5) * 0.3;
          break;
      }

      ball.active = true;
      pitcher.pitching = true;
      pitcher.frame = 0;
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawField();
      drawPitcher();
      drawBatter();
      drawBall();
      updateBall();

      if (batter.swinging && batter.frame >= 5) batter.swinging = false;
      if (pitcher.pitching && pitcher.frame >= 5) pitcher.pitching = false;

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
